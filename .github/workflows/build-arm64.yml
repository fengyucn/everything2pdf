name: Build Linux ARM64

on:
  workflow_dispatch:  # 仅手动触发

jobs:
  build-linux-arm64:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Build in ARM64 Docker
        run: |
          docker run --rm --platform linux/arm64 \
            -v ${{ github.workspace }}:/app \
            -w /app \
            python:3.11-slim-bullseye \
            bash -c "
              apt-get update && apt-get install -y binutils
              pip install --upgrade pip
              pip install -r requirements.txt pyinstaller
              pyinstaller build_linux.spec
            "
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: everything2pdf-linux-arm64
          path: dist/everything2pdf
